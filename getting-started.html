<html><head><title>whales: Getting Started</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Andi Miller" /><meta name="description" content="Cats-based Docker Client" /><meta name="og:image" content="/whales/img/poster.png" /><meta name="image" property="og:image" content="/whales/img/poster.png" /><meta name="og:title" content="whales: Getting Started" /><meta name="title" property="og:title" content="whales: Getting Started" /><meta name="og:site_name" content="whales" /><meta name="og:url" content="http://andimiller.github.io/andimiller/" /><meta name="og:type" content="website" /><meta name="og:description" content="Cats-based Docker Client" /><link rel="icon" type="image/png" href="/whales/img/favicon.png" /><meta name="twitter:title" content="whales: Getting Started" /><meta name="twitter:image" content="http://andimiller.github.io//whales/img/poster.png" /><meta name="twitter:description" content="Cats-based Docker Client" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/whales/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/whales/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/whales/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/whales/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/whales/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/whales/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/whales/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/whales/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/whales/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/whales/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/whales/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/whales/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/whales/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/whales/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/whales/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/whales/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/whales/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/whales/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/whales/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/whales/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/whales/highlight/styles/default.css" /><link rel="stylesheet" href="/whales/css/style.css" /><link rel="stylesheet" href="/whales/css/palette.css" /><link rel="stylesheet" href="/whales/css/codemirror.css" /><link rel="stylesheet" href="/whales/css/override.css" /><link rel="stylesheet" href="/whales/css/toc.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/whales/" class="brand"><div class="brand-wrapper"><span>whales</span></div></a></li> <li><a href="/whales/getting-started.html" class=" active ">Getting Started</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/andimiller/whales"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/andimiller/whales"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('whales Cats-based Docker Client');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('whales Cats-based Docker Client');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="andimiller" data-github-repo="whales"><div class="content-wrapper"><section><h1>Getting Started</h1>

<nav role="navigation" id="toc"></nav>

<h1 id="dependencies">Dependencies</h1>

<p>insert it here once I’ve published it to bintray</p>

<h1 id="imports">Imports</h1>

<p>Make sure you have the standard cats imports.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats._</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">implicits</span><span class="o">.</span><span class="k">_</span>
<span class="k">import</span> <span class="nn">cats._</span>
<span class="k">import</span> <span class="nn">cats.implicits._</span>
</code></pre></div></div>

<p>And the main cats-effect import.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">cats.effect._</span>
<span class="k">import</span> <span class="nn">cats.effect._</span>
</code></pre></div></div>

<p>Then you can also import this library.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">net.andimiller.docker._</span>
<span class="k">import</span> <span class="nn">net.andimiller.docker._</span>
</code></pre></div></div>

<h1 id="docker-client">Docker client</h1>

<p>To make a docker client you simply call the Docker object with your effect type (see cats-effect to learn more about effect types).</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Docker</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">cats.effect.Resource</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">net.andimiller.docker.Docker.DockerClient</span><span class="o">[</span><span class="kt">cats.effect.IO</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Bind</span><span class="o">(</span><span class="nc">Allocate</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;),</span><span class="n">net</span><span class="o">.</span><span class="n">andimiller</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="nc">Docker$$$Lambda$6089</span><span class="o">/</span><span class="mi">1132717954</span><span class="k">@</span><span class="mi">2</span><span class="n">bb2cee6</span><span class="o">)</span>
</code></pre></div></div>

<p>This client itself is a resource, (since it internally keeps a spotify docker client with a pool), so it’s easiest if we use it in a for comprehension.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="n">docker</span> <span class="k">&lt;-</span> <span class="nc">Docker</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
     <span class="o">|</span>   <span class="n">nginx</span> <span class="k">&lt;-</span> <span class="n">docker</span><span class="o">(</span><span class="s">"nginx"</span><span class="o">,</span> <span class="s">"latest"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span> <span class="k">yield</span> <span class="n">nginx</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">cats.effect.Resource</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">net.andimiller.docker.Docker.DockerContainer</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Bind</span><span class="o">(</span><span class="nc">Bind</span><span class="o">(</span><span class="nc">Allocate</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;),</span><span class="n">net</span><span class="o">.</span><span class="n">andimiller</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="nc">Docker$$$Lambda$6089</span><span class="o">/</span><span class="mi">1132717954</span><span class="k">@</span><span class="mi">158</span><span class="n">b3478</span><span class="o">),</span><span class="nc">$$Lambda$6191</span><span class="o">/</span><span class="mi">648332006</span><span class="nd">@fba10d1</span><span class="o">)</span>
</code></pre></div></div>

<p>The client has an apply method which takes arguments on what kind of docker image we want, if you’d like to see all available options see the <code class="highlighter-rouge">DockerImage</code> class, and the default parameters on the apply method.</p>

<p>You can also pass in a DockerImage if you’d rather work with the case class.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">net.andimiller.docker.Docker.DockerImage</span>
<span class="k">import</span> <span class="nn">net.andimiller.docker.Docker.DockerImage</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="n">docker</span> <span class="k">&lt;-</span> <span class="nc">Docker</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
     <span class="o">|</span>   <span class="n">nginx</span> <span class="k">&lt;-</span> <span class="n">docker</span><span class="o">(</span><span class="nc">DockerImage</span><span class="o">(</span><span class="s">"nginx"</span><span class="o">,</span> <span class="s">"latest"</span><span class="o">))</span>
     <span class="o">|</span> <span class="o">}</span> <span class="k">yield</span> <span class="n">nginx</span>
<span class="n">res2</span><span class="k">:</span> <span class="kt">cats.effect.Resource</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">net.andimiller.docker.Docker.DockerContainer</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Bind</span><span class="o">(</span><span class="nc">Bind</span><span class="o">(</span><span class="nc">Allocate</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;),</span><span class="n">net</span><span class="o">.</span><span class="n">andimiller</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="nc">Docker$$$Lambda$6089</span><span class="o">/</span><span class="mi">1132717954</span><span class="k">@</span><span class="mi">49</span><span class="n">ef5159</span><span class="o">),</span><span class="nc">$$Lambda$6198</span><span class="o">/</span><span class="mi">994888164</span><span class="k">@</span><span class="mf">27f</span><span class="n">b14f1</span><span class="o">)</span>
</code></pre></div></div>

<h1 id="waiting-for-containers-to-come-up">Waiting for containers to come up</h1>

<p>The main way to wait for a container right now is waiting for a TCP socket to be bound, this is done like so:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="n">docker</span> <span class="k">&lt;-</span> <span class="nc">Docker</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
     <span class="o">|</span>   <span class="n">nginx</span> <span class="k">&lt;-</span> <span class="n">docker</span><span class="o">(</span><span class="s">"nginx"</span><span class="o">,</span> <span class="s">"latest"</span><span class="o">)</span>
     <span class="o">|</span>   <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">nginx</span><span class="o">.</span><span class="n">waitForPort</span><span class="o">(</span><span class="mi">80</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span> <span class="k">yield</span> <span class="n">nginx</span>
<span class="n">res3</span><span class="k">:</span> <span class="kt">cats.effect.Resource</span><span class="o">[</span><span class="kt">cats.effect.IO</span>,<span class="kt">net.andimiller.docker.Docker.DockerContainer</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Bind</span><span class="o">(</span><span class="nc">Bind</span><span class="o">(</span><span class="nc">Allocate</span><span class="o">(&lt;</span><span class="n">function1</span><span class="o">&gt;),</span><span class="n">net</span><span class="o">.</span><span class="n">andimiller</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="nc">Docker$$$Lambda$6089</span><span class="o">/</span><span class="mi">1132717954</span><span class="k">@</span><span class="mi">74</span><span class="n">bc8f7d</span><span class="o">),</span><span class="nc">$$Lambda$6214</span><span class="o">/</span><span class="mi">1761121280</span><span class="k">@</span><span class="mf">2d</span><span class="n">f996e1</span><span class="o">)</span>
</code></pre></div></div>

<p>This will attempt to acquire an open TCP socket to the specified port on that container and will do an exponential backoff, this backoff can be tuned with the optional parameters, such as <code class="highlighter-rouge">backoffs</code> which is defaulted to <code class="highlighter-rouge">5</code>.</p>


<link rel="stylesheet" type="text/css" href="/whales/css/toc.css"></link>
<script type="text/javascript" src="/whales/js/toc.js"></script>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/whales/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/whales/js/toc.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'andimiller/whales'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/whales/js/main.js"></script></body></html>